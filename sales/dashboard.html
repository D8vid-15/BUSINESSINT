<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Dashboard | Business Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --sales-color: #3b82f6;
            --sales-dark: #2563eb;
            --sales-light: #dbeafe;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --accounts-color: #8b5cf6;
            --store-color: #10b981;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Navigation */
        .navbar {
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            color: var(--sales-color);
            font-size: 24px;
        }
        
        .logo-text {
            font-weight: 600;
            font-size: 18px;
            color: var(--dark);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .user-details {
            text-align: right;
        }
        
        .user-name {
            font-weight: 500;
            font-size: 14px;
        }
        
        .user-role {
            font-size: 12px;
            color: var(--gray);
        }
        
        .logout-btn {
            padding: 8px 16px;
            background-color: transparent;
            color: var(--danger);
            border: 1px solid var(--danger);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .logout-btn:hover {
            background-color: var(--danger);
            color: white;
        }
        
        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 68px);
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Sidebar */
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid var(--light-gray);
            padding: 24px 0;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 0 24px 20px;
            border-bottom: 1px solid var(--light-gray);
            margin-bottom: 20px;
        }
        
        .sidebar-title {
            font-size: 14px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .sidebar-menu {
            list-style: none;
            flex: 1;
        }
        
        .menu-item {
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            font-size: 14px;
            color: var(--dark);
        }
        
        .menu-item:hover {
            background-color: var(--sales-light);
        }
        
        .menu-item.active {
            background-color: var(--sales-light);
            border-left-color: var(--sales-color);
            color: var(--sales-color);
            font-weight: 500;
        }
        
        .menu-item i {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 32px;
            min-width: 0;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }
        
        .dashboard-header h1 {
            font-size: 24px;
            color: var(--dark);
            font-weight: 600;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: var(--sales-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--sales-dark);
        }
        
        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #047857;
        }
        
        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--light-gray);
        }
        
        .stat-card h3 {
            font-size: 13px;
            color: var(--gray);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark);
        }
        
        .stat-card .subtext {
            font-size: 13px;
            color: var(--gray);
        }
        
        /* Tables */
        .card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--light-gray);
            margin-bottom: 24px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        thead {
            background-color: #f8fafc;
        }
        
        th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--gray);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--light-gray);
            white-space: nowrap;
        }
        
        td {
            padding: 16px;
            border-bottom: 1px solid var(--light-gray);
            vertical-align: middle;
        }
        
        tr:hover {
            background-color: #f8fafc;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-draft {
            background-color: #f1f5f9;
            color: var(--gray);
        }
        
        .status-pending-accounts {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .status-approved {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-rejected {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .status-pending-release {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-delivered {
            background-color: #10b981;
            color: white;
        }
        
        .status-cancelled {
            background-color: #6b7280;
            color: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
            background: none;
        }
        
        .action-btn.view {
            background-color: #f0f9ff;
            color: #0ea5e9;
            border-color: #0ea5e9;
        }
        
        .action-btn.view:hover {
            background-color: #0ea5e9;
            color: white;
        }
        
        .action-btn.edit {
            background-color: var(--sales-light);
            color: var(--sales-color);
            border-color: var(--sales-color);
        }
        
        .action-btn.edit:hover {
            background-color: var(--sales-color);
            color: white;
        }
        
        .action-btn.submit {
            background-color: #d1fae5;
            color: #059669;
            border-color: #059669;
        }
        
        .action-btn.submit:hover {
            background-color: #059669;
            color: white;
        }
        
        .action-btn.delete {
            background-color: #fee2e2;
            color: #dc2626;
            border-color: #dc2626;
        }
        
        .action-btn.delete:hover {
            background-color: #dc2626;
            color: white;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--light-gray);
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        /* Create Order Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
            background-color: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--sales-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Carton inputs */
        .carton-inputs {
            margin: 20px 0;
        }
        
        .carton-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
            padding: 12px;
            background-color: #f8fafc;
            border-radius: 6px;
        }
        
        .carton-label {
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Product size indicators */
        .product-size-info {
            display: inline-block;
            margin-left: 8px;
            font-size: 11px;
            padding: 2px 6px;
            background-color: #dbeafe;
            color: var(--sales-color);
            border-radius: 4px;
            font-weight: 500;
        }
        
        /* Order items table */
        .order-items-table {
            width: 100%;
            margin: 20px 0;
        }
        
        .order-items-table th {
            padding: 10px;
            background-color: #f8fafc;
            font-size: 12px;
        }
        
        .order-items-table td {
            padding: 10px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        /* Customer cards */
        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .customer-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }
        
        .customer-card:hover {
            border-color: var(--sales-color);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }
        
        .customer-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .customer-info {
            font-size: 13px;
            color: var(--gray);
            margin-bottom: 8px;
        }
        
        /* Order summary */
        .order-summary {
            background-color: #f8fafc;
            border-radius: 6px;
            padding: 16px;
            margin: 20px 0;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .summary-total {
            font-weight: 600;
            font-size: 18px;
            color: var(--dark);
            border-top: 1px solid var(--light-gray);
            padding-top: 12px;
            margin-top: 12px;
        }
        
        /* Workflow Timeline */
        .workflow-timeline {
            position: relative;
            margin: 20px 0;
            padding-left: 30px;
        }
        
        .workflow-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--light-gray);
        }
        
        .workflow-step {
            position: relative;
            margin-bottom: 20px;
        }
        
        .workflow-step:last-child {
            margin-bottom: 0;
        }
        
        .workflow-marker {
            position: absolute;
            left: -30px;
            top: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--light-gray);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .workflow-marker.active {
            background-color: var(--sales-color);
        }
        
        .workflow-marker.completed {
            background-color: var(--success);
        }
        
        .workflow-content {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            padding: 16px;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                padding: 24px;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                flex-direction: row;
                padding: 0;
                overflow-x: auto;
                border-right: none;
                border-bottom: 1px solid var(--light-gray);
            }
            
            .sidebar-header {
                display: none;
            }
            
            .sidebar-menu {
                display: flex;
                flex: 1;
                padding: 0;
            }
            
            .menu-item {
                padding: 16px 20px;
                border-left: none;
                border-bottom: 4px solid transparent;
                white-space: nowrap;
            }
            
            .menu-item.active {
                border-left: none;
                border-bottom-color: var(--sales-color);
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .customer-grid {
                grid-template-columns: 1fr;
            }
            
            .carton-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <i class="fas fa-chart-line logo-icon"></i>
                <span class="logo-text">Sales Department</span>
            </div>
            
            <div class="user-info">
                <div class="user-details">
                    <div class="user-name" id="userName">Sales User</div>
                    <div class="user-role">Sales Department</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Dashboard Layout -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Sales Portal</div>
            </div>
            
            <ul class="sidebar-menu">
                <li class="menu-item active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </li>
                <li class="menu-item" data-page="orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Sales Orders</span>
                </li>
                <li class="menu-item" data-page="customers">
                    <i class="fas fa-users"></i>
                    <span>Customers</span>
                </li>
                <li class="menu-item" data-page="products">
                    <i class="fas fa-boxes"></i>
                    <span>Products & Pricing</span>
                </li>
                <li class="menu-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Sales Reports</span>
                </li>
            </ul>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page-content">
                <div class="dashboard-header">
                    <h1>Sales Dashboard</h1>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="newOrderBtn">
                            <i class="fas fa-plus"></i> New Sales Order
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Today's Sales</h3>
                        <div class="value" id="todaySales">₦0</div>
                        <div class="subtext">Total value</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>This Month</h3>
                        <div class="value" id="monthSales">₦0</div>
                        <div class="subtext">Total sales</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Pending Accounts</h3>
                        <div class="value" id="pendingAccounts">0</div>
                        <div class="subtext">Awaiting payment</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Pending Store</h3>
                        <div class="value" id="pendingStore">0</div>
                        <div class="subtext">Awaiting release</div>
                    </div>
                </div>
                
                <!-- Recent Orders -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Recent Sales Orders</h2>
                        <button class="btn btn-secondary" id="viewAllOrdersBtn">
                            View All
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table id="recentOrdersTable">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Cartons</th>
                                    <th>Total Value</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Recent orders will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="empty-state" id="noRecentOrders" style="display: none;">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>No Recent Orders</h3>
                        <p>Create your first sales order to get started</p>
                    </div>
                </div>
                
                <!-- Sales Workflow -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Order Workflow</h2>
                    </div>
                    
                    <div class="workflow-timeline" id="workflowTimeline">
                        <div class="workflow-step">
                            <div class="workflow-marker completed">1</div>
                            <div class="workflow-content">
                                <div style="font-weight: 600; margin-bottom: 4px;">Sales Order Created</div>
                                <div style="font-size: 13px; color: var(--gray);">
                                    Sales department creates order with carton details
                                </div>
                            </div>
                        </div>
                        
                        <div class="workflow-step">
                            <div class="workflow-marker completed">2</div>
                            <div class="workflow-content">
                                <div style="font-weight: 600; margin-bottom: 4px;">Accounts Approval</div>
                                <div style="font-size: 13px; color: var(--gray);">
                                    Accounts department verifies and approves payment
                                </div>
                            </div>
                        </div>
                        
                        <div class="workflow-step">
                            <div class="workflow-marker active">3</div>
                            <div class="workflow-content">
                                <div style="font-weight: 600; margin-bottom: 4px;">Store Release</div>
                                <div style="font-size: 13px; color: var(--gray);">
                                    Store department releases goods after payment approval
                                </div>
                            </div>
                        </div>
                        
                        <div class="workflow-step">
                            <div class="workflow-marker">4</div>
                            <div class="workflow-content">
                                <div style="font-weight: 600; margin-bottom: 4px;">Delivery Complete</div>
                                <div style="font-size: 13px; color: var(--gray);">
                                    Order delivered to customer and marked complete
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Orders Page -->
            <div id="ordersPage" class="page-content" style="display: none;">
                <div class="dashboard-header">
                    <h1>Sales Orders</h1>
                    <div>
                        <select class="form-control" id="ordersFilter" style="width: auto; display: inline-block; margin-right: 12px;">
                            <option value="all">All Orders</option>
                            <option value="draft">Draft</option>
                            <option value="pending-accounts">Pending Accounts</option>
                            <option value="approved">Payment Approved</option>
                            <option value="pending-release">Pending Store Release</option>
                            <option value="delivered">Delivered</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <button class="btn btn-primary" id="createOrderBtn">
                            <i class="fas fa-plus"></i> New Order
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="table-container">
                        <table id="allOrdersTable">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Cartons</th>
                                    <th>Total Value</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- All orders will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="empty-state" id="noFilteredOrders" style="display: none;">
                        <i class="fas fa-search"></i>
                        <h3>No Orders Found</h3>
                        <p>No orders match your current filter</p>
                    </div>
                </div>
            </div>
            
            <!-- Customers Page -->
            <div id="customersPage" class="page-content" style="display: none;">
                <div class="dashboard-header">
                    <h1>Customer Management</h1>
                    <div>
                        <input type="text" class="form-control" id="customerSearch" placeholder="Search customers..." style="width: 200px; display: inline-block; margin-right: 12px;">
                        <button class="btn btn-primary" id="addCustomerBtn">
                            <i class="fas fa-plus"></i> Add Customer
                        </button>
                    </div>
                </div>
                
                <div class="customer-grid" id="customersGrid">
                    <!-- Customer cards will be loaded here -->
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-users"></i>
                        <h3>Customer Management</h3>
                        <p>Customer management features will be displayed here</p>
                    </div>
                </div>
            </div>
            
            <!-- Products Page -->
            <div id="productsPage" class="page-content" style="display: none;">
                <div class="dashboard-header">
                    <h1>Products & Pricing</h1>
                    <div>
                        <button class="btn btn-primary" id="updatePricesBtn">
                            <i class="fas fa-edit"></i> Update Prices
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="empty-state">
                        <i class="fas fa-boxes"></i>
                        <h3>Products & Pricing</h3>
                        <p>Product catalog and pricing management will be displayed here</p>
                    </div>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div id="reportsPage" class="page-content" style="display: none;">
                <div class="dashboard-header">
                    <h1>Sales Reports</h1>
                    <div>
                        <select class="form-control" id="reportPeriod" style="width: auto; display: inline-block; margin-right: 12px;">
                            <option value="month">This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                        <button class="btn btn-primary">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="empty-state">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Sales Reports</h3>
                        <p>Sales analytics and reports will be displayed here</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Create Order Modal -->
    <div class="modal" id="createOrderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Sales Order</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="createOrderForm">
                    <div class="form-group">
                        <label for="customerSelect">Customer *</label>
                        <select id="customerSelect" class="form-control" required>
                            <option value="">Select Customer</option>
                            <option value="customer1">ABC Trading Company</option>
                            <option value="customer2">XYZ Enterprises</option>
                            <option value="customer3">Global Oil Distributors</option>
                            <option value="customer4">Premium Auto Parts</option>
                            <option value="new">+ Add New Customer</option>
                        </select>
                    </div>
                    
                    <div id="newCustomerFields" style="display: none;">
                        <div class="form-group">
                            <label for="newCustomerName">Customer Name *</label>
                            <input type="text" id="newCustomerName" class="form-control" placeholder="Enter customer name">
                        </div>
                        
                        <div class="form-group">
                            <label for="newCustomerPhone">Phone Number</label>
                            <input type="tel" id="newCustomerPhone" class="form-control" placeholder="Enter phone number">
                        </div>
                        
                        <div class="form-group">
                            <label for="newCustomerEmail">Email Address</label>
                            <input type="email" id="newCustomerEmail" class="form-control" placeholder="Enter email address">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="orderDate">Order Date *</label>
                        <input type="date" id="orderDate" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="deliveryDate">Expected Delivery Date *</label>
                        <input type="date" id="deliveryDate" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Order Items * <span style="font-size: 12px; color: var(--gray);">(Products with available carton sizes)</span></label>
                        <div class="carton-inputs" id="orderItemsContainer">
                            <div class="empty-state" style="padding: 20px;">
                                <i class="fas fa-shopping-cart"></i>
                                <p>Add products to your order</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <button type="button" class="btn btn-secondary" id="addProductBtn" style="width: 100%;">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                    
                    <div id="orderSummary" class="order-summary" style="display: none;">
                        <h4 style="margin-bottom: 16px; font-weight: 600;">Order Summary</h4>
                        <div class="summary-row">
                            <span>Total Products:</span>
                            <span id="summaryProductCount">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Cartons:</span>
                            <span id="summaryCartonCount">0</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total Value:</span>
                            <span id="summaryTotalValue">₦0</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentMethod">Payment Method *</label>
                        <select id="paymentMethod" class="form-control" required>
                            <option value="cash">Cash</option>
                            <option value="transfer">Bank Transfer</option>
                            <option value="pos">POS Payment</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="orderNotes">Order Notes</label>
                        <textarea id="orderNotes" class="form-control" placeholder="Add any notes about this order..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="salesRep">Sales Representative *</label>
                        <input type="text" id="salesRep" class="form-control" required>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" id="saveDraftBtn" style="flex: 1;">
                            <i class="fas fa-save"></i> Save as Draft
                        </button>
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-paper-plane"></i> Submit to Accounts
                        </button>
                        <button type="button" class="btn btn-secondary" id="cancelOrderBtn">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Product specifications (matching store inventory)
        const productSpecs = {
            'DLS': { 
                name: 'DLS', 
                availableSizes: [4, 25], 
                category: 'Oil',
                unitPrice: { 4: 4500, 25: 28000 }
            },
            'PLUS': { 
                name: 'PLUS', 
                availableSizes: [1], 
                category: 'Oil',
                unitPrice: { 1: 5200 }
            },
            'SUPER': { 
                name: 'SUPER', 
                availableSizes: [1, 4], 
                category: 'Oil',
                unitPrice: { 1: 5800, 4: 22000 }
            },
            'EXTRA': { 
                name: 'EXTRA', 
                availableSizes: [1, 4, 5], 
                category: 'Oil',
                unitPrice: { 1: 6200, 4: 24000, 5: 29500 }
            },
            'POWER': { 
                name: 'POWER', 
                availableSizes: [4, 25], 
                category: 'Oil',
                unitPrice: { 4: 7500, 25: 45000 }
            },
            'ATF': { 
                name: 'ATF', 
                availableSizes: [1, 4], 
                category: 'Oil',
                unitPrice: { 1: 6800, 4: 26000 }
            },
            'GEAR OIL': { 
                name: 'GEAR OIL', 
                availableSizes: [4, 25], 
                category: 'Oil',
                unitPrice: { 4: 8500, 25: 52000 }
            },
            'HYD': { 
                name: 'HYD', 
                availableSizes: [25], 
                category: 'Oil',
                unitPrice: { 25: 35000 }
            }
        };
        
        // Sales orders data
        let salesOrders = JSON.parse(localStorage.getItem('sales_orders') || '[]');
        
        // Customers data (removed credit fields)
        let customers = JSON.parse(localStorage.getItem('sales_customers') || '[]');
        
        // Store inventory (for stock checking)
        let storeInventory = JSON.parse(localStorage.getItem('store_products') || '{}');
        
        // Pending releases for store department
        let pendingReleases = JSON.parse(localStorage.getItem('store_pending_releases') || '[]');
        
        // DOM Elements
        const pages = {
            dashboard: document.getElementById('dashboardPage'),
            orders: document.getElementById('ordersPage'),
            customers: document.getElementById('customersPage'),
            products: document.getElementById('productsPage'),
            reports: document.getElementById('reportsPage')
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const isAuthenticated = localStorage.getItem('sales_authenticated');
            if (!isAuthenticated) {
                window.location.href = 'login.html';
                return;
            }
            
            // Load user data
            const userData = JSON.parse(localStorage.getItem('sales_user') || '{}');
            if (userData.name) {
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('salesRep').value = userData.name;
            }
            
            // Set default order date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('orderDate').value = today;
            
            // Set delivery date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('deliveryDate').value = tomorrow.toISOString().split('T')[0];
            
            // Initialize data
            initializeData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Load initial view
            showPage('dashboard');
            updateDashboardStats();
            loadRecentOrders();
        });
        
        function initializeData() {
            // Initialize customers if empty (removed credit fields)
            if (customers.length === 0) {
                customers = [
                    {
                        id: 'customer1',
                        name: 'ABC Trading Company',
                        type: 'Distributor',
                        phone: '+234 801 234 5678',
                        email: 'abc@trading.com',
                        address: '123 Trade Street, Lagos',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'customer2',
                        name: 'XYZ Enterprises',
                        type: 'Retailer',
                        phone: '+234 802 345 6789',
                        email: 'sales@xyzenterprises.com',
                        address: '456 Business Avenue, Abuja',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'customer3',
                        name: 'Global Oil Distributors',
                        type: 'Wholesaler',
                        phone: '+234 803 456 7890',
                        email: 'info@globaloil.com',
                        address: '789 Oil Road, Port Harcourt',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'customer4',
                        name: 'Premium Auto Parts',
                        type: 'Retailer',
                        phone: '+234 804 567 8901',
                        email: 'sales@premiumautoparts.com',
                        address: '321 Auto Plaza, Ibadan',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('sales_customers', JSON.stringify(customers));
            }
            
            // Initialize sales orders if empty
            if (salesOrders.length === 0) {
                // Add sample orders
                const sampleOrders = [
                    {
                        id: generateOrderId(),
                        customerId: 'customer1',
                        customerName: 'ABC Trading Company',
                        orderDate: '2024-04-15',
                        deliveryDate: '2024-04-17',
                        items: [
                            {
                                product: 'SUPER',
                                carton1L: 20,
                                carton4L: 10,
                                unitPrice1L: 5800,
                                unitPrice4L: 22000,
                                totalCartons: 30,
                                totalValue: (20 * 5800) + (10 * 22000)
                            },
                            {
                                product: 'EXTRA',
                                carton1L: 15,
                                carton5L: 5,
                                unitPrice1L: 6200,
                                unitPrice5L: 29500,
                                totalCartons: 20,
                                totalValue: (15 * 6200) + (5 * 29500)
                            }
                        ],
                        totalCartons: 50,
                        totalValue: 336500,
                        paymentMethod: 'transfer',
                        paymentStatus: 'pending',
                        status: 'pending-accounts',
                        salesRep: 'John Salesman',
                        notes: 'Urgent delivery requested',
                        createdAt: new Date('2024-04-15T10:30:00').toISOString(),
                        workflow: [
                            { step: 'sales', status: 'completed', date: '2024-04-15', user: 'John Salesman' },
                            { step: 'accounts', status: 'pending', date: null, user: null },
                            { step: 'store', status: 'pending', date: null, user: null },
                            { step: 'delivery', status: 'pending', date: null, user: null }
                        ]
                    },
                    {
                        id: generateOrderId(),
                        customerId: 'customer3',
                        customerName: 'Global Oil Distributors',
                        orderDate: '2024-04-14',
                        deliveryDate: '2024-04-16',
                        items: [
                            {
                                product: 'DLS',
                                carton4L: 25,
                                carton25L: 5,
                                unitPrice4L: 4500,
                                unitPrice25L: 28000,
                                totalCartons: 30,
                                totalValue: (25 * 4500) + (5 * 28000)
                            }
                        ],
                        totalCartons: 30,
                        totalValue: 252500,
                        paymentMethod: 'cash',
                        paymentStatus: 'approved',
                        status: 'approved',
                        salesRep: 'Sarah Salesrep',
                        notes: 'Delivered on time',
                        createdAt: new Date('2024-04-14T14:20:00').toISOString(),
                        workflow: [
                            { step: 'sales', status: 'completed', date: '2024-04-14', user: 'Sarah Salesrep' },
                            { step: 'accounts', status: 'completed', date: '2024-04-15', user: 'Accounts Manager' },
                            { step: 'store', status: 'pending', date: null, user: null },
                            { step: 'delivery', status: 'pending', date: null, user: null }
                        ]
                    },
                    {
                        id: generateOrderId(),
                        customerId: 'customer2',
                        customerName: 'XYZ Enterprises',
                        orderDate: '2024-04-10',
                        deliveryDate: '2024-04-12',
                        items: [
                            {
                                product: 'PLUS',
                                carton1L: 50,
                                unitPrice1L: 5200,
                                totalCartons: 50,
                                totalValue: 50 * 5200
                            }
                        ],
                        totalCartons: 50,
                        totalValue: 260000,
                        paymentMethod: 'cash',
                        paymentStatus: 'approved',
                        status: 'pending-release',
                        salesRep: 'Mike Sales',
                        notes: 'Regular monthly order',
                        createdAt: new Date('2024-04-10T09:15:00').toISOString(),
                        workflow: [
                            { step: 'sales', status: 'completed', date: '2024-04-10', user: 'Mike Sales' },
                            { step: 'accounts', status: 'completed', date: '2024-04-11', user: 'Accounts Officer' },
                            { step: 'store', status: 'pending', date: null, user: null },
                            { step: 'delivery', status: 'pending', date: null, user: null }
                        ]
                    }
                ];
                
                salesOrders = sampleOrders;
                localStorage.setItem('sales_orders', JSON.stringify(salesOrders));
                
                // Create pending release for store department
                const approvedOrder = sampleOrders.find(order => order.status === 'pending-release');
                if (approvedOrder) {
                    const releaseExists = pendingReleases.some(release => release.orderId === approvedOrder.id);
                    if (!releaseExists) {
                        pendingReleases.push({
                            id: 'REL-' + Date.now(),
                            orderId: approvedOrder.id,
                            customerName: approvedOrder.customerName,
                            approvedDate: new Date().toISOString(),
                            deliveryDate: approvedOrder.deliveryDate,
                            items: approvedOrder.items.map(item => ({
                                productCode: item.product,
                                productName: item.product,
                                orderedQty: item.totalCartons,
                                unitPrice: item.totalValue / item.totalCartons,
                                cartonDetails: item
                            })),
                            totalValue: approvedOrder.totalValue,
                            status: 'pending',
                            createdAt: new Date().toISOString()
                        });
                        localStorage.setItem('store_pending_releases', JSON.stringify(pendingReleases));
                    }
                }
            }
        }
        
        function setupEventListeners() {
            // Sidebar navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    showPage(page);
                });
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('sales_authenticated');
                localStorage.removeItem('sales_user');
                window.location.href = 'login.html';
            });
            
            // Dashboard buttons
            document.getElementById('newOrderBtn').addEventListener('click', showCreateOrderModal);
            document.getElementById('viewAllOrdersBtn').addEventListener('click', function() {
                showPage('orders');
            });
            
            // Orders page buttons
            document.getElementById('createOrderBtn').addEventListener('click', showCreateOrderModal);
            document.getElementById('ordersFilter').addEventListener('change', loadAllOrders);
            
            // Customers page buttons
            document.getElementById('addCustomerBtn').addEventListener('click', function() {
                alert('Add customer functionality will be implemented here');
            });
            
            // Modal buttons
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('createOrderModal').style.display = 'none';
            });
            
            document.getElementById('cancelOrderBtn').addEventListener('click', function() {
                document.getElementById('createOrderModal').style.display = 'none';
            });
            
            // Form buttons
            document.getElementById('addProductBtn').addEventListener('click', addProductRow);
            
            document.getElementById('saveDraftBtn').addEventListener('click', function(e) {
                e.preventDefault();
                saveOrderAsDraft();
            });
            
            document.getElementById('createOrderForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitOrderToAccounts();
            });
            
            // Customer selection
            document.getElementById('customerSelect').addEventListener('change', function() {
                const newCustomerFields = document.getElementById('newCustomerFields');
                if (this.value === 'new') {
                    newCustomerFields.style.display = 'block';
                } else {
                    newCustomerFields.style.display = 'none';
                }
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('createOrderModal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        function showPage(pageName) {
            // Hide all pages
            Object.values(pages).forEach(page => {
                if (page) page.style.display = 'none';
            });
            
            // Remove active class from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            if (pages[pageName]) {
                pages[pageName].style.display = 'block';
            }
            
            // Add active class to selected menu item
            const menuItem = document.querySelector(`.menu-item[data-page="${pageName}"]`);
            if (menuItem) {
                menuItem.classList.add('active');
            }
            
            // Update page-specific data
            if (pageName === 'dashboard') {
                updateDashboardStats();
                loadRecentOrders();
            } else if (pageName === 'orders') {
                loadAllOrders();
            } else if (pageName === 'customers') {
                loadCustomers();
            }
        }
        
        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];
            
            // Calculate today's sales
            const todaySales = salesOrders
                .filter(order => order.orderDate === today && order.status !== 'draft' && order.status !== 'cancelled')
                .reduce((sum, order) => sum + order.totalValue, 0);
            
            // Calculate this month's sales
            const now = new Date();
            const monthSales = salesOrders
                .filter(order => {
                    const orderDate = new Date(order.orderDate);
                    return orderDate.getMonth() === now.getMonth() && 
                           orderDate.getFullYear() === now.getFullYear() &&
                           order.status !== 'draft' && 
                           order.status !== 'cancelled';
                })
                .reduce((sum, order) => sum + order.totalValue, 0);
            
            // Count orders pending accounts approval
            const pendingAccounts = salesOrders.filter(order => 
                order.status === 'pending-accounts'
            ).length;
            
            // Count orders pending store release
            const pendingStore = salesOrders.filter(order => 
                order.status === 'pending-release'
            ).length;
            
            // Update UI
            document.getElementById('todaySales').textContent = `₦${todaySales.toLocaleString()}`;
            document.getElementById('monthSales').textContent = `₦${monthSales.toLocaleString()}`;
            document.getElementById('pendingAccounts').textContent = pendingAccounts;
            document.getElementById('pendingStore').textContent = pendingStore;
        }
        
        function loadRecentOrders() {
            const tableBody = document.querySelector('#recentOrdersTable tbody');
            const emptyState = document.getElementById('noRecentOrders');
            
            if (salesOrders.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Sort by date (newest first) and get recent 10 orders
            const recentOrders = [...salesOrders]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 10);
            
            tableBody.innerHTML = recentOrders.map(order => {
                const date = new Date(order.orderDate);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric'
                });
                
                return `
                    <tr>
                        <td>${order.id}</td>
                        <td>${order.customerName}</td>
                        <td>${order.totalCartons}</td>
                        <td>₦${order.totalValue.toLocaleString()}</td>
                        <td>${formattedDate}</td>
                        <td><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view" onclick="viewOrder('${order.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${order.status === 'draft' ? `
                                <button class="action-btn edit" onclick="editOrder('${order.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn submit" onclick="submitOrderToAccounts('${order.id}')">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function loadAllOrders() {
            const tableBody = document.querySelector('#allOrdersTable tbody');
            const emptyState = document.getElementById('noFilteredOrders');
            const filter = document.getElementById('ordersFilter').value;
            
            let filteredOrders = salesOrders;
            
            if (filter !== 'all') {
                filteredOrders = salesOrders.filter(order => order.status === filter);
            }
            
            if (filteredOrders.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Sort by date (newest first)
            const sortedOrders = [...filteredOrders].sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );
            
            tableBody.innerHTML = sortedOrders.map(order => {
                const itemsCount = order.items.length;
                const date = new Date(order.orderDate);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
                
                // Build items string
                const itemsString = order.items.map(item => 
                    `${item.product} (${item.totalCartons})`
                ).join(', ');
                
                return `
                    <tr>
                        <td>${order.id}</td>
                        <td>${order.customerName}</td>
                        <td>${itemsString}</td>
                        <td>${order.totalCartons}</td>
                        <td>₦${order.totalValue.toLocaleString()}</td>
                        <td>${formattedDate}</td>
                        <td><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view" onclick="viewOrder('${order.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${order.status === 'draft' ? `
                                <button class="action-btn edit" onclick="editOrder('${order.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn submit" onclick="submitOrderToAccounts('${order.id}')">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                <button class="action-btn delete" onclick="deleteOrder('${order.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function loadCustomers() {
            const customersGrid = document.getElementById('customersGrid');
            
            if (customers.length === 0) {
                customersGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-users"></i>
                        <h3>No Customers</h3>
                        <p>Add your first customer to get started</p>
                    </div>
                `;
                return;
            }
            
            customersGrid.innerHTML = customers.map(customer => {
                // Calculate total orders for this customer
                const customerOrders = salesOrders.filter(order => 
                    order.customerId === customer.id && order.status !== 'draft' && order.status !== 'cancelled'
                );
                const totalOrders = customerOrders.length;
                const totalValue = customerOrders.reduce((sum, order) => sum + order.totalValue, 0);
                
                return `
                    <div class="customer-card">
                        <div class="customer-name">${customer.name}</div>
                        <div class="customer-info">
                            <div><i class="fas fa-user-tag"></i> ${customer.type}</div>
                            <div><i class="fas fa-phone"></i> ${customer.phone}</div>
                            <div><i class="fas fa-envelope"></i> ${customer.email}</div>
                            ${customer.address ? `<div><i class="fas fa-map-marker-alt"></i> ${customer.address}</div>` : ''}
                        </div>
                        <div style="margin-top: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                                <span style="font-size: 12px; color: var(--gray);">Total Orders:</span>
                                <span style="font-weight: 600;">${totalOrders}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                <span style="font-size: 12px; color: var(--gray);">Total Value:</span>
                                <span style="font-weight: 600; color: var(--sales-color);">₦${totalValue.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showCreateOrderModal() {
            document.getElementById('createOrderModal').style.display = 'flex';
            resetOrderForm();
        }
        
        function resetOrderForm() {
            document.getElementById('createOrderForm').reset();
            document.getElementById('orderItemsContainer').innerHTML = `
                <div class="empty-state" style="padding: 20px;">
                    <i class="fas fa-shopping-cart"></i>
                    <p>Add products to your order</p>
                </div>
            `;
            document.getElementById('orderSummary').style.display = 'none';
            document.getElementById('newCustomerFields').style.display = 'none';
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('orderDate').value = today;
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('deliveryDate').value = tomorrow.toISOString().split('T')[0];
            
            // Set sales rep name
            const userData = JSON.parse(localStorage.getItem('sales_user') || '{}');
            if (userData.name) {
                document.getElementById('salesRep').value = userData.name;
            }
            
            // Set default payment method
            document.getElementById('paymentMethod').value = 'cash';
        }
        
        function addProductRow() {
            const container = document.getElementById('orderItemsContainer');
            
            // Remove empty state if present
            const emptyState = container.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
            
            // Create new product row
            const productRow = document.createElement('div');
            productRow.className = 'product-row';
            productRow.style.marginBottom = '16px';
            productRow.style.padding = '16px';
            productRow.style.border = '1px solid var(--light-gray)';
            productRow.style.borderRadius = '6px';
            productRow.style.backgroundColor = '#f8fafc';
            
            const productId = 'product_' + Date.now() + Math.random().toString(36).substr(2, 5);
            
            productRow.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                    <div style="font-weight: 600;">Product Item</div>
                    <button type="button" class="remove-product-btn" style="background: none; border: none; color: var(--danger); cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-size: 13px;">Product *</label>
                        <select class="form-control product-select" data-id="${productId}" style="width: 100%;">
                            <option value="">Select Product</option>
                            ${Object.keys(productSpecs).map(productName => {
                                const product = productSpecs[productName];
                                return `<option value="${productName}">${productName} <span class="product-size-info">${product.availableSizes.map(s => `${s}L`).join(', ')}</span></option>`;
                            }).join('')}
                        </select>
                    </div>
                </div>
                
                <div class="carton-inputs" id="cartons_${productId}">
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        <i class="fas fa-box"></i>
                        <p>Select a product to see available carton sizes</p>
                    </div>
                </div>
            `;
            
            container.appendChild(productRow);
            
            // Add event listeners
            const selectElement = productRow.querySelector('.product-select');
            selectElement.addEventListener('change', function() {
                updateCartonInputsForProduct(this);
            });
            
            const removeBtn = productRow.querySelector('.remove-product-btn');
            removeBtn.addEventListener('click', function() {
                productRow.remove();
                updateOrderSummary();
            });
            
            // Show order summary if hidden
            document.getElementById('orderSummary').style.display = 'block';
        }
        
        function updateCartonInputsForProduct(selectElement) {
            const productName = selectElement.value;
            const productId = selectElement.dataset.id;
            const cartonContainer = document.getElementById(`cartons_${productId}`);
            
            if (!productName) {
                cartonContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        <i class="fas fa-box"></i>
                        <p>Select a product to see available carton sizes</p>
                    </div>
                `;
                return;
            }
            
            const product = productSpecs[productName];
            
            let html = '';
            product.availableSizes.forEach(size => {
                // Check available stock from store inventory
                const availableStock = storeInventory[productName] ? 
                    storeInventory[productName][`carton${size}L`] || 0 : 0;
                
                html += `
                    <div class="carton-row">
                        <div class="carton-label">${size}L Cartons</div>
                        <input type="number" 
                               class="form-control carton-qty" 
                               data-product="${productName}"
                               data-size="${size}"
                               data-price="${product.unitPrice[size]}"
                               min="0" 
                               max="${availableStock}"
                               value="0" 
                               placeholder="0"
                               style="width: 100px;"
                               oninput="updateOrderSummary()">
                        <div style="font-size: 12px; color: ${availableStock > 0 ? 'var(--success)' : 'var(--danger)'};">
                            Available: ${availableStock}
                        </div>
                    </div>
                `;
            });
            
            cartonContainer.innerHTML = html;
            
            // Add event listeners to new inputs
            cartonContainer.querySelectorAll('.carton-qty').forEach(input => {
                input.addEventListener('input', updateOrderSummary);
            });
            
            updateOrderSummary();
        }
        
        function updateOrderSummary() {
            const productRows = document.querySelectorAll('.product-row');
            let totalProducts = 0;
            let totalCartons = 0;
            let totalValue = 0;
            
            productRows.forEach(row => {
                const productSelect = row.querySelector('.product-select');
                if (productSelect.value) {
                    totalProducts++;
                    
                    const cartonInputs = row.querySelectorAll('.carton-qty');
                    cartonInputs.forEach(input => {
                        const quantity = parseInt(input.value) || 0;
                        const price = parseInt(input.dataset.price) || 0;
                        
                        totalCartons += quantity;
                        totalValue += quantity * price;
                    });
                }
            });
            
            document.getElementById('summaryProductCount').textContent = totalProducts;
            document.getElementById('summaryCartonCount').textContent = totalCartons;
            document.getElementById('summaryTotalValue').textContent = `₦${totalValue.toLocaleString()}`;
            
            // Show/hide order summary
            document.getElementById('orderSummary').style.display = totalProducts > 0 ? 'block' : 'none';
        }
        
        function collectOrderItems() {
            const productRows = document.querySelectorAll('.product-row');
            const orderItems = [];
            let totalCartons = 0;
            let totalValue = 0;
            
            for (const row of productRows) {
                const productSelect = row.querySelector('.product-select');
                if (!productSelect.value) continue;
                
                const productName = productSelect.value;
                const product = productSpecs[productName];
                
                const cartonInputs = row.querySelectorAll('.carton-qty');
                let hasCartons = false;
                
                const item = {
                    product: productName
                };
                
                let itemTotalCartons = 0;
                let itemTotalValue = 0;
                
                cartonInputs.forEach(input => {
                    const quantity = parseInt(input.value) || 0;
                    if (quantity > 0) {
                        hasCartons = true;
                        const size = input.dataset.size;
                        const price = parseFloat(input.dataset.price);
                        
                        item[`carton${size}L`] = quantity;
                        item[`unitPrice${size}L`] = price;
                        
                        itemTotalCartons += quantity;
                        itemTotalValue += quantity * price;
                    }
                });
                
                if (!hasCartons) {
                    alert(`Please enter quantity for at least one carton size for ${productName}`);
                    return null;
                }
                
                // Check stock availability
                for (const size of product.availableSizes) {
                    const quantity = item[`carton${size}L`] || 0;
                    if (quantity > 0) {
                        const availableStock = storeInventory[productName] ? 
                            storeInventory[productName][`carton${size}L`] || 0 : 0;
                        
                        if (quantity > availableStock) {
                            alert(`Insufficient stock for ${productName} ${size}L cartons\nAvailable: ${availableStock}, Requested: ${quantity}`);
                            return null;
                        }
                    }
                }
                
                item.totalCartons = itemTotalCartons;
                item.totalValue = itemTotalValue;
                
                orderItems.push(item);
                totalCartons += itemTotalCartons;
                totalValue += itemTotalValue;
            }
            
            if (orderItems.length === 0) {
                alert('Please add at least one product to the order');
                return null;
            }
            
            return { orderItems, totalCartons, totalValue };
        }
        
        function saveOrderAsDraft() {
            const customerSelect = document.getElementById('customerSelect');
            const customerId = customerSelect.value;
            let customerName = '';
            
            if (customerId === 'new') {
                const newName = document.getElementById('newCustomerName').value.trim();
                if (!newName) {
                    alert('Please enter customer name for new customer');
                    return;
                }
                customerName = newName;
            } else {
                const selectedCustomer = customers.find(c => c.id === customerId);
                if (!selectedCustomer) {
                    alert('Please select a customer');
                    return;
                }
                customerName = selectedCustomer.name;
            }
            
            // Collect order items
            const orderItems = collectOrderItems();
            if (!orderItems) return;
            
            const { orderItems: items, totalCartons, totalValue } = orderItems;
            
            // Create new customer if needed
            if (customerId === 'new') {
                const newCustomer = {
                    id: 'customer' + Date.now(),
                    name: customerName,
                    type: 'New Customer',
                    phone: document.getElementById('newCustomerPhone').value,
                    email: document.getElementById('newCustomerEmail').value,
                    address: '',
                    createdAt: new Date().toISOString()
                };
                customers.push(newCustomer);
                localStorage.setItem('sales_customers', JSON.stringify(customers));
            }
            
            // Create draft order object
            const draftOrder = {
                id: generateOrderId(),
                customerId: customerId === 'new' ? customers[customers.length - 1].id : customerId,
                customerName: customerName,
                orderDate: document.getElementById('orderDate').value,
                deliveryDate: document.getElementById('deliveryDate').value,
                items: items,
                totalCartons: totalCartons,
                totalValue: totalValue,
                paymentMethod: document.getElementById('paymentMethod').value,
                paymentStatus: 'pending',
                status: 'draft',
                salesRep: document.getElementById('salesRep').value,
                notes: document.getElementById('orderNotes').value,
                createdAt: new Date().toISOString(),
                workflow: [
                    { step: 'sales', status: 'draft', date: new Date().toISOString().split('T')[0], user: document.getElementById('salesRep').value },
                    { step: 'accounts', status: 'pending', date: null, user: null },
                    { step: 'store', status: 'pending', date: null, user: null },
                    { step: 'delivery', status: 'pending', date: null, user: null }
                ]
            };
            
            // Add to orders
            salesOrders.push(draftOrder);
            localStorage.setItem('sales_orders', JSON.stringify(salesOrders));
            
            // Close modal
            document.getElementById('createOrderModal').style.display = 'none';
            
            // Show success message
            alert(`Order saved as draft!\n\nOrder ID: ${draftOrder.id}\nCustomer: ${customerName}\nTotal Cartons: ${totalCartons}\nTotal Value: ₦${totalValue.toLocaleString()}\n\nYou can edit and submit this order later.`);
            
            // Update displays
            updateDashboardStats();
            loadRecentOrders();
            if (document.getElementById('ordersPage').style.display !== 'none') {
                loadAllOrders();
            }
        }
        
        function submitOrderToAccounts(orderId = null) {
            // If orderId is provided, submit existing order
            if (orderId) {
                const orderIndex = salesOrders.findIndex(o => o.id === orderId);
                if (orderIndex === -1) return;
                
                const order = salesOrders[orderIndex];
                
                // Check if order is in draft status
                if (order.status !== 'draft') {
                    alert('Only draft orders can be submitted to accounts');
                    return;
                }
                
                // Update order status
                salesOrders[orderIndex].status = 'pending-accounts';
                salesOrders[orderIndex].paymentStatus = 'pending';
                salesOrders[orderIndex].workflow[1].status = 'pending';
                salesOrders[orderIndex].workflow[1].date = new Date().toISOString().split('T')[0];
                
                localStorage.setItem('sales_orders', JSON.stringify(salesOrders));
                
                alert(`Order ${orderId} submitted to Accounts Department for payment approval.`);
                
                // Update displays
                updateDashboardStats();
                loadRecentOrders();
                if (document.getElementById('ordersPage').style.display !== 'none') {
                    loadAllOrders();
                }
                
                return;
            }
            
            // Otherwise, create new order from form
            const customerSelect = document.getElementById('customerSelect');
            const customerId = customerSelect.value;
            let customerName = '';
            
            if (customerId === 'new') {
                const newName = document.getElementById('newCustomerName').value.trim();
                if (!newName) {
                    alert('Please enter customer name for new customer');
                    return;
                }
                customerName = newName;
            } else {
                const selectedCustomer = customers.find(c => c.id === customerId);
                if (!selectedCustomer) {
                    alert('Please select a customer');
                    return;
                }
                customerName = selectedCustomer.name;
            }
            
            const orderDate = document.getElementById('orderDate').value;
            const deliveryDate = document.getElementById('deliveryDate').value;
            const salesRep = document.getElementById('salesRep').value;
            const notes = document.getElementById('orderNotes').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            // Validate dates
            if (new Date(deliveryDate) < new Date(orderDate)) {
                alert('Delivery date cannot be earlier than order date');
                return;
            }
            
            // Collect order items
            const orderItems = collectOrderItems();
            if (!orderItems) return;
            
            const { orderItems: items, totalCartons, totalValue } = orderItems;
            
            // Create new customer if needed
            if (customerId === 'new') {
                const newCustomer = {
                    id: 'customer' + Date.now(),
                    name: customerName,
                    type: 'New Customer',
                    phone: document.getElementById('newCustomerPhone').value,
                    email: document.getElementById('newCustomerEmail').value,
                    address: '',
                    createdAt: new Date().toISOString()
                };
                customers.push(newCustomer);
                localStorage.setItem('sales_customers', JSON.stringify(customers));
            }
            
            // Create order object
            const newOrder = {
                id: generateOrderId(),
                customerId: customerId === 'new' ? customers[customers.length - 1].id : customerId,
                customerName: customerName,
                orderDate: orderDate,
                deliveryDate: deliveryDate,
                items: items,
                totalCartons: totalCartons,
                totalValue: totalValue,
                paymentMethod: paymentMethod,
                paymentStatus: 'pending',
                status: 'pending-accounts',
                salesRep: salesRep,
                notes: notes,
                createdAt: new Date().toISOString(),
                workflow: [
                    { step: 'sales', status: 'completed', date: orderDate, user: salesRep },
                    { step: 'accounts', status: 'pending', date: null, user: null },
                    { step: 'store', status: 'pending', date: null, user: null },
                    { step: 'delivery', status: 'pending', date: null, user: null }
                ]
            };
            
            // Add to orders
            salesOrders.push(newOrder);
            localStorage.setItem('sales_orders', JSON.stringify(salesOrders));
            
            // Close modal
            document.getElementById('createOrderModal').style.display = 'none';
            
            // Show success message
            alert(`Order submitted to Accounts Department!\n\nOrder ID: ${newOrder.id}\nCustomer: ${customerName}\nTotal Cartons: ${totalCartons}\nTotal Value: ₦${totalValue.toLocaleString()}\n\nAccounts will now verify the payment.`);
            
            // Update displays
            updateDashboardStats();
            loadRecentOrders();
            if (document.getElementById('ordersPage').style.display !== 'none') {
                loadAllOrders();
            }
        }
        
        function viewOrder(orderId) {
            const order = salesOrders.find(o => o.id === orderId);
            if (!order) {
                alert('Order not found');
                return;
            }
            
            let orderDetails = `Order ID: ${order.id}\n`;
            orderDetails += `Customer: ${order.customerName}\n`;
            orderDetails += `Order Date: ${order.orderDate}\n`;
            orderDetails += `Delivery Date: ${order.deliveryDate}\n`;
            orderDetails += `Status: ${getStatusText(order.status)}\n`;
            orderDetails += `Payment Method: ${order.paymentMethod}\n`;
            orderDetails += `Payment Status: ${order.paymentStatus === 'approved' ? 'Approved' : 'Pending'}\n`;
            orderDetails += `Sales Rep: ${order.salesRep}\n`;
            orderDetails += `Total Cartons: ${order.totalCartons}\n`;
            orderDetails += `Total Value: ₦${order.totalValue.toLocaleString()}\n\n`;
            
            orderDetails += `Order Items:\n`;
            order.items.forEach((item, index) => {
                orderDetails += `${index + 1}. ${item.product}:\n`;
                
                // Show carton sizes
                if (item.carton1L > 0) orderDetails += `   - 1L: ${item.carton1L} cartons (₦${item.unitPrice1L.toLocaleString()} each)\n`;
                if (item.carton4L > 0) orderDetails += `   - 4L: ${item.carton4L} cartons (₦${item.unitPrice4L.toLocaleString()} each)\n`;
                if (item.carton5L > 0) orderDetails += `   - 5L: ${item.carton5L} cartons (₦${item.unitPrice5L.toLocaleString()} each)\n`;
                if (item.carton25L > 0) orderDetails += `   - 25L: ${item.carton25L} cartons (₦${item.unitPrice25L.toLocaleString()} each)\n`;
                
                orderDetails += `   Subtotal: ${item.totalCartons} cartons = ₦${item.totalValue.toLocaleString()}\n\n`;
            });
            
            if (order.notes) {
                orderDetails += `Notes: ${order.notes}\n`;
            }
            
            alert(orderDetails);
        }
        
        function editOrder(orderId) {
            const order = salesOrders.find(o => o.id === orderId);
            if (!order) {
                alert('Order not found');
                return;
            }
            
            alert('Order editing functionality will be implemented here. This would open a form pre-filled with order details.');
        }
        
        function deleteOrder(orderId) {
            if (!confirm('Are you sure you want to delete this order? This action cannot be undone.')) {
                return;
            }
            
            const orderIndex = salesOrders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;
            
            // Remove the order
            salesOrders.splice(orderIndex, 1);
            localStorage.setItem('sales_orders', JSON.stringify(salesOrders));
            
            alert('Order deleted successfully');
            
            // Update displays
            updateDashboardStats();
            loadRecentOrders();
            if (document.getElementById('ordersPage').style.display !== 'none') {
                loadAllOrders();
            }
        }
        
        function generateOrderId() {
            const now = new Date();
            const year = now.getFullYear().toString().substr(-2);
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `SO-${year}${month}${day}-${random}`;
        }
        
        function getStatusText(status) {
            const statusMap = {
                'draft': 'Draft',
                'pending-accounts': 'Pending Accounts',
                'approved': 'Payment Approved',
                'pending-release': 'Pending Store Release',
                'delivered': 'Delivered',
                'cancelled': 'Cancelled'
            };
            return statusMap[status] || status;
        }
    </script>
</body>
</html>